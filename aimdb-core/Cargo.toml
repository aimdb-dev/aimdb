[package]
name = "aimdb-core"
version.workspace = true
edition.workspace = true
license.workspace = true
description = "Core database engine for AimDB - async in-memory storage with real-time synchronization"
build = "build.rs"

[features]
default = []

# Platform targets (mutually exclusive)
std = ["thiserror", "anyhow", "serde_json"]
embedded = []

# Runtime adapters
tokio-runtime = ["tokio", "std"]
embassy-runtime = [
    "embassy-executor",
    "embassy-time",
    "embassy-futures",
    "embedded",
]

# Observability features (optional on both platforms)
tracing = [
    "dep:tracing",
] # Note: embedded targets may need no_std compatible tracing config
metrics = ["dep:metrics", "std"]

# Testing features
test-utils = ["std"]

[dependencies]
# Procedural macros (always available)
aimdb-macros = { path = "../aimdb-macros" }

# Serialization (optional)
serde = { workspace = true, optional = true }

# Error handling - only for std environments
thiserror = { workspace = true, optional = true }
anyhow = { workspace = true, optional = true }
serde_json = { workspace = true, optional = true }

# Runtime dependencies (optional)
tokio = { workspace = true, optional = true }
embassy-executor = { workspace = true, optional = true }
embassy-time = { workspace = true, optional = true }
embassy-futures = { workspace = true, optional = true }

# Observability (optional)
tracing = { workspace = true, optional = true }
metrics = { workspace = true, optional = true }

[dev-dependencies]
# For no_std testing
heapless = "0.9.1"
# For async testing
tokio = { workspace = true, features = ["macros", "rt", "time"] }
