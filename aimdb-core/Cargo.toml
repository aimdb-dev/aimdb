[package]
name = "aimdb-core"
version.workspace = true
edition.workspace = true
license.workspace = true
description = "Core database engine for AimDB - async in-memory storage with real-time synchronization"
build = "build.rs"

[features]
default = ["std"]

# Core capabilities
std = ["thiserror", "anyhow", "serde_json", "aimdb-executor/std"]

# Runtime adapters (imply capability requirements)
tokio-runtime = ["std", "tokio"]       # Tokio requires std
embassy-runtime = ["embassy-executor"] # Embassy works in no_std

# Heap allocation in no_std environments
alloc = ["serde"] # Enable heap in no_std

# Observability features (available on both std/no_std)
tracing = ["dep:tracing"]        # Works in both std and no_std environments
metrics = ["dep:metrics", "std"] # Requires std for aggregation

# Testing features
test-utils = ["std"]

[dependencies]
# Executor traits (always available)
aimdb-executor = { path = "../aimdb-executor", default-features = false }

# Procedural macros (always available)
aimdb-macros = { path = "../aimdb-macros" }

# Serialization (optional)
serde = { workspace = true, optional = true }

# Error handling - only for std environments
thiserror = { workspace = true, optional = true }
anyhow = { workspace = true, optional = true }
serde_json = { workspace = true, optional = true }

# Runtime support (optional)
tokio = { workspace = true, optional = true }
embassy-executor = { workspace = true, optional = true }

# Observability (optional)
tracing = { workspace = true, optional = true }
metrics = { workspace = true, optional = true }

[dev-dependencies]
# For no_std testing
heapless = "0.9.1"
# For async testing
tokio = { workspace = true, features = ["macros", "rt", "time"] }
